<%- include('partials/head') %>

<div class="stores-page">
    <div class="stores-header">
        <div class="stores-header-content">
            <h1>All Stores</h1>
            <p>Discover trusted sellers and their quality badminton products</p>
        </div>
    </div>
    
    <div class="stores-container">
        <!-- Filters Section -->
        <div class="stores-filters">
            <form action="/stores" method="GET" class="stores-filter-form">
                <div class="search-filter">
                    <label for="search">Search Stores</label>
                    <div class="search-input-wrapper">
                        <input type="text" id="search" name="search" value="<%= search %>" placeholder="Store name or owner...">
                        <button type="submit" class="search-submit-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        </button>
                    </div>
                </div>
                
                <div class="sort-filter">
                    <label for="sort">Sort By</label>
                    <select id="sort" name="sort" onchange="this.form.submit()">
                        <option value="" <%= !sort ? 'selected' : '' %>>Featured First</option>
                        <option value="name_asc" <%= sort === 'name_asc' ? 'selected' : '' %>>Name (A-Z)</option>
                        <option value="name_desc" <%= sort === 'name_desc' ? 'selected' : '' %>>Name (Z-A)</option>
                        <option value="newest" <%= sort === 'newest' ? 'selected' : '' %>>Newest First</option>
                        <option value="oldest" <%= sort === 'oldest' ? 'selected' : '' %>>Oldest First</option>
                    </select>
                </div>
                
                <% if (search) { %>
                    <a href="/stores" class="clear-filters-btn">Clear Search</a>
                <% } %>
            </form>
        </div>
        
        <!-- Results Info -->
        <div class="stores-results-info">
            <p>
                <% if (search) { %>
                    Showing <%= totalStores %> store<%= totalStores !== 1 ? 's' : '' %> for "<strong><%= search %></strong>"
                <% } else { %>
                    <%= totalStores %> store<%= totalStores !== 1 ? 's' : '' %> available
                <% } %>
            </p>
        </div>
        
        <!-- Stores Grid -->
        <% if (stores.length > 0) { %>
            <div class="stores-grid">
                <% stores.forEach(store => { %>
                    <a href="/store/<%= store._id %>" class="store-card">
                        <div class="store-card-header">
                            <div class="store-avatar-wrapper">
                                <div class="store-avatar">
                                    <span><%= store.storeName.charAt(0).toUpperCase() %></span>
                                </div>
                                <% if (store.featured) { %>
                                    <span class="featured-indicator" title="Featured Store">⭐</span>
                                <% } %>
                            </div>
                        </div>
                        <div class="store-card-body">
                            <h3 class="store-name"><%= store.storeName %></h3>
                            <p class="store-owner">by <%= store.name %></p>
                            <div class="store-stats">
                                <span class="store-stat">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"></path><line x1="3" y1="6" x2="21" y2="6"></line><path d="M16 10a4 4 0 0 1-8 0"></path></svg>
                                    <strong><%= store.productCount %></strong> Products
                                </span>
                                <span class="store-stat">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>
                                    Since <%= new Date(store.createdAt).getFullYear() %>
                                </span>
                            </div>
                        </div>
                        <div class="store-card-footer">
                            <span class="visit-store-btn">Visit Store →</span>
                        </div>
                    </a>
                <% }) %>
            </div>
            
            <!-- Pagination -->
            <% if (totalPages > 1) { %>
            <nav class="pagination">
                <div class="pagination-info">
                    Showing <%= (currentPage - 1) * perPage + 1 %>-<%= Math.min(currentPage * perPage, totalStores) %> of <%= totalStores %> stores
                </div>
                <div class="pagination-controls">
                    <% if (currentPage > 1) { %>
                        <a href="<%= buildPaginationUrl(1) %>" class="pagination-btn" title="First page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="11 17 6 12 11 7"></polyline><polyline points="18 17 13 12 18 7"></polyline></svg>
                        </a>
                        <a href="<%= buildPaginationUrl(currentPage - 1) %>" class="pagination-btn" title="Previous page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        </a>
                    <% } %>
                    
                    <div class="pagination-pages">
                        <% 
                        let startPage = Math.max(1, currentPage - 2);
                        let endPage = Math.min(totalPages, currentPage + 2);
                        
                        if (startPage > 1) { %>
                            <a href="<%= buildPaginationUrl(1) %>" class="pagination-page">1</a>
                            <% if (startPage > 2) { %>
                                <span class="pagination-ellipsis">...</span>
                            <% } %>
                        <% }
                        
                        for (let i = startPage; i <= endPage; i++) { %>
                            <a href="<%= buildPaginationUrl(i) %>" class="pagination-page <%= i === currentPage ? 'active' : '' %>"><%= i %></a>
                        <% }
                        
                        if (endPage < totalPages) { %>
                            <% if (endPage < totalPages - 1) { %>
                                <span class="pagination-ellipsis">...</span>
                            <% } %>
                            <a href="<%= buildPaginationUrl(totalPages) %>" class="pagination-page"><%= totalPages %></a>
                        <% } %>
                    </div>
                    
                    <% if (currentPage < totalPages) { %>
                        <a href="<%= buildPaginationUrl(currentPage + 1) %>" class="pagination-btn" title="Next page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </a>
                        <a href="<%= buildPaginationUrl(totalPages) %>" class="pagination-btn" title="Last page">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="13 17 18 12 13 7"></polyline><polyline points="6 17 11 12 6 7"></polyline></svg>
                        </a>
                    <% } %>
                </div>
            </nav>
            <% } %>
        <% } else { %>
            <div class="no-stores">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <h3>No stores found</h3>
                <p>
                    <% if (search) { %>
                        No stores match your search "<%= search %>". Try a different search term.
                    <% } else { %>
                        There are no stores available at the moment.
                    <% } %>
                </p>
                <% if (search) { %>
                    <a href="/stores" class="btn btn-primary">View All Stores</a>
                <% } %>
            </div>
        <% } %>
    </div>
</div>

<%- include('partials/tail') %>
